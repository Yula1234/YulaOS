# YulaOS

YulaOS is an operating system written primarily in C/C++ (freestanding) and FASM, with its own kernel, drivers and userland.

## Features

- **SMP**: multicore support.
- **Filesystem**: custom inode-based filesystem (YulaFS).
- **Memory**: paging + kernel heap.
- **Graphics**: userland GUI stack with a window manager (`axwm`) and compositor (`flux`).
- **Userland**: native apps (shell `ush`, `term`, `geditor`, `explorer`, networking `networkd`, utilities like `ping`).
- **Tooling**: custom assembler/linker in userland (`asmc`, `uld`) plus a build script for the host.

## Repository layout

- **`src/`**: kernel + drivers + core libraries.
- **`include/`**: public headers.
- **`programs/`**: userland applications.
- **`usr/`**: userland runtime, libc-like bits, linker script.
- **`tools/`**: host tools (e.g. `yulafs_tool` used to populate `disk.img`).
- **`build.sh`**: main build + run entrypoint.

## Building & running (Linux)

### Requirements

- `gcc` / `g++` with 32-bit multilib support (the build uses `-m32`)
- `ld` (binutils)
- `fasm`
- `grub-mkrescue` (GRUB tools)
- `qemu-system-i386`

Typically you also need:

- `xorriso` (required by `grub-mkrescue`)
- `ccache` (optional)

### Build + run

The default workflow is a single command:

```bash
./build.sh
```

What it does:

- builds the kernel (`bin/kernel.bin`)
- builds userland apps into `bin/usr/*.exe`
- populates `disk.img` via `tools/yulafs_tool`
- produces a bootable ISO `bin/yulaos.iso`
- runs QEMU and logs serial output to `trace.txt`

### Output artifacts

After a successful run you will typically have:

- `bin/kernel.bin`: multiboot kernel binary
- `bin/yulaos.iso`: bootable ISO generated by GRUB
- `disk.img`: YulaFS disk image populated with userland binaries and runtime files
- `trace.txt`: serial log from QEMU

### QEMU configuration

`build.sh` runs `qemu-system-i386` .

If QEMU fails to start on your machine:

- Remove or change `-accel kvm` in `build.sh` if KVM is not available.
- Remove `-display sdl,gl=on` / `virtio-vga-gl` if OpenGL acceleration is not available.

### Kernel profiling build

To build with function instrumentation (profiler hooks):

```bash
KERNEL_PROFILE=1 ./build.sh
```

## Notes

### Networking in QEMU

`build.sh` runs QEMU with user-mode networking and an `ne2k` NIC.

- **Gateway** is typically `10.0.2.2`
- **DNS** proxy is typically `10.0.2.3`

If hostname resolution does not work inside YulaOS, make sure `networkd` is using DNS `10.0.2.3` (QEMU user-net).

## Troubleshooting

### Missing 32-bit build support

The build uses `gcc -m32` / `g++ -m32`. On many distros you need multilib packages installed.

### `grub-mkrescue` fails

Make sure GRUB tools and `xorriso` are installed (many distros package them separately).

### `fasm` not found

Install Flat Assembler (`fasm`) and ensure it is available in `PATH`.